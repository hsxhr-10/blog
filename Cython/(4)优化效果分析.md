# 优化效果分析

回到 [HelloCython.md]() 中的例子，我们已经知道 Cython 是通过把 .pyx 文件编译成 C/C++ 代码来提升性能的，那是不是每一行的 .pyx 都能被优化到呢？并不是，并且通过如下命令可以看到实际的优化效果：

```bash
$ cython sdm_pog_pk.pyx -a
```

执行之后，可以得到一个 HTML 文件，浏览器打开如下：

![](https://github.com/hsxhr-10/Blog/blob/master/image/%E4%BC%98%E5%8C%96%E6%95%88%E6%9E%9C%E5%88%86%E6%9E%901.png)

白色代表可以优化成纯 C/C++ 代码，黄色代表和 Python 发生了交互，颜色越深，代表发生的交互越多，优化效果也越差，点开行数前面的 + 号，还可以看到对应的 C/C++ 代码。可以看到这个例子的优化效果已经很不错了，因为头一行黄色基本上是跑不掉的，最后一行因为要返回东西到 Python 环境，也是跑不掉。而至于为什么 % 那一行也会黄色，倒不是这行不能被优化，而是编译器的一些问题，官方给出了[解决方法](https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#compiler-directives)

通过 Cython 提供的这种可视化方式，可以很直观地看到哪些代码没被优化，优化程度去到哪里。