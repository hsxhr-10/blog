# 优化效果分析

回到 [HelloCython.md] 中的例子，关键代码如下：

```Cython
# hello_cython.pyx
def primes_cython_v1(int nb_primes):
    cdef int[19999] p
    cdef int n

    # 防止数组越界
    if nb_primes > 19999:
        nb_primes = 19999
    
    len_p = 0
    n = 2

    while len_p < nb_primes:
        for i in p:
            for i in p[:len_p]:
                if n % i == 0:
                    break
            else:
                p[len_p] = n
                len_p += 1

            n += 1

    return [prime for prime in p[:len_p]]
```

```Python
# setup.py
from distutils.core import setup
from distutils.extension import Extension
from Cython.Distutils import build_ext

ext_modules = [Extension(
    name="hello_cython",
    sources=["hello_cython.pyx"],
)]
setup(
    name="hello_cython pyx",
    cmdclass={'build_ext': build_ext},
    ext_modules=ext_modules,
)
```

```Python
# demo.py
import hello_cython


def main():
    nb_primes = 19999
    hello_cython.primes_cython_v1(nb_primes)


if __name__ == "__main__":
    main()
```

我们已经知道 Cython 是通过把 .pyx 文件编译成 C 代码来提升性能的，那是不是每一行的 .pyx 都能被优化到呢？并不是，通过如下命令可以看到实际的优化效果：

```bash
$ cython sdm_pog_pk.pyx -a
```