# 函数式编程风格

## What

函数式编程是一种编程范式（面向过程、面向对象也是编程范式），简单地理解，主要思想是把处理问题的步骤写成一系列嵌套的函数调用。

举例说明：

假设有一个待解决的问题：求 (1 + 2) * 3 - 4 的结果

面向过程风格的代码是

```python
a = 1 + 2
b = a * 3
c = b - 4
```

函数式编程风格的代码是

```python
c = subtract(multiply(add(1, 2), 3), 4)
```

一般涉及到的概念有：闭包、lambda 表达式、将函数当作普通变量传递等。Python 中用得比较多的函数式编程技能有 `lambda`、`map()`、`filter()`、`reduce()`、装饰器等。

## Why

深奥的大道理说不出来，个人感觉函数式编程更加符合研究人员的思维习惯，比如一些数学研究人员，他们在解决问题时，可能更加喜欢描述事物间的映射关系而不是步骤的堆砌。从一般的开发角度看，函数式编程一般可以让代码更加的优雅，减少啰哩啰嗦的感觉。

## How

下面例举一些 Python 中常用的函数式编程风格代码。

1. `lambda` + `map()`
     ```ipython
     In [147]: l = [1, 2, 3]

     In [148]: r = map(lambda x: x*2, l)

     In [149]: l
     Out[149]: [1, 2, 3]

     In [150]: type(r)
     Out[150]: map

     In [151]: list(r)
     Out[151]: [2, 4, 6]
     ```

     ```ipython
     In [153]: l = [1, 2, 3]

     In [154]: r = map(lambda x: x*2, l)

     In [155]: next(r)
     Out[155]: 2

     In [156]: next(r)
     Out[156]: 4

     In [157]: next(r)
     Out[157]: 6

     In [158]: next(r)
     ---------------------------------------------------------------------------
     StopIteration                             Traceback (most recent call last)
     <ipython-input-158-8ebe59a56b1d> in <module>
     ----> 1 next(r)

     StopIteration:
     ```

    - `map()` 的结果是一个生成器，可以用 `next()` 函数访问，也可以专程 list
    - `map()` 不会修改原来的列表

2. `lambda` + `filter()`
     ```ipython
     In [159]: l = [1, 2, 32, 12, 55, 86, 21, 90]

     In [160]: r = filter(lambda x: x > 12, l)

     In [161]: list(r)
     Out[161]: [32, 55, 86, 21, 90]
     ```

     ```ipython
     In [159]: l = [1, 2, 32, 12, 55, 86, 21, 90]

     In [160]: r = filter(lambda x: x > 12, l)

     In [163]: next(r)
     Out[163]: 32

     In [164]: next(r)
     Out[164]: 55

     In [165]: next(r)
     Out[165]: 86

     In [166]: next(r)
     Out[166]: 21

     In [167]: next(r)
     Out[167]: 90

     In [168]: next(r)
     ---------------------------------------------------------------------------
     StopIteration                             Traceback (most recent call last)
     <ipython-input-168-8ebe59a56b1d> in <module>
     ----> 1 next(r)

     StopIteration:

     In [169]:
     ```

    - `filter()` 的结果是一个生成器，可以用 `next()` 函数访问，也可以转换成 list 使用
    - `filter()` 需要传入的函数返回 `True` 或者 `False`

3. `lambda` + `reduce()`
     ```ipython
     In [172]: from functools import reduce
          ...: r = reduce( (lambda x, y: x * y), [1, 2, 3, 4] )

     In [173]: r
     Out[173]: 24
     ```

    - `reduce()` 的结果不是生成器，是一个值
    - `reduce()` 的 lambda 表达式需要接收两个参数