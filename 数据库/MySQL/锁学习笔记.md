# 锁学习笔记

1. 锁的作用
2. 锁的类型
3. 如何上锁
4. 行锁实现方法
5. 加锁分析（和实验）
6. 死锁
7. 排查锁的问题
8. 乐观锁和悲观锁

读操作：SELECT
写操作：INSERT，UPDATE，DELETE

表锁加锁规则：
- 读锁
    - 自身读操作正常，自身写操作会报错
    - 其他读操作正常，其他写操作会阻塞
- 写锁
    - 自身读操作正常，自身写操作正常
    - 其他读操作会阻塞，其他写操作会阻塞

行锁加锁规则：
- 读锁
    - 自身事务读操作正常，自身事务写操作正常
    - 其他事务读操作正常，其他事务写操作会阻塞
- 写锁
    - 自身事务读操作正常，自身事务写操作正常
    - 其他事务读操作正常（简单的读操作走 MVCC 快照读，加锁的读操作阻塞），其他事务写操作会阻塞

为什么上了写锁，别的事务还可以读操作？
因为InnoDB有MVCC机制（多版本并发控制），可以使用快照读，而不会被阻塞。

select * from information_schema.INNODB_LOCKS;

- 同一个事务加的 `GAP LOCK` 是可以插入的
- 多用唯一联合索引