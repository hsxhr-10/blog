# 索引学习笔记

1. 索引结构
2. 索引设计
3. 执行计划

## 索引结构

一般来说，索引类型可以分为两种：聚簇索引（或者叫主键索引）和二级索引，二级索引又分为单列二级索引和联合二级索引

### 聚簇索引

### 二级索引

#### 单列二级索引

#### 联合二级索引

## 索引设计

- 【建议】索引命名，主键索引以 `pk_` 开头；唯一索引以 `uq_` 或 `uk_` 开头；普通索引以 `idx_` 开头，一律使用小写，以字段名为后缀
- 【强制】InnoDB、MyISAM 存储引擎的索引类型必须为 `BTREE`；MEMORY 存储引擎可以是 `BTREE` 或者 `HASH`
- 【建议】单表的索引个数不超过 7 个
- 【建议】建立索引时，多考虑联合索引，区分度高的字段放前面
- 【建议】多表 `join` 的 SQL，确保被驱动表的连接列上有索引。因为这样的 `join` 效率最高（执行计划中前面的是驱动表，后面的是被驱动表）
- 【建议】加索引时，确保同一个表不存在冗余索引，比如已经有联合索引 KEY(a, b)，则 KEY(a) 是冗余的

## 执行计划

执行计划提供以下帮助：

- 分析索引使用情况，提供优化依据
- 连接查询时，显示驱动表是哪个，被驱动表是哪个（驱动表在前面，被驱动表在后面），从而可以分析被驱动表的连接列上有没有用到索引

案例：

```SQL
mysql> explain select * from employees where emp_no = 10001;
+----+-------------+-----------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref   | rows | filtered | Extra |
+----+-------------+-----------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
|  1 | SIMPLE      | employees | NULL       | const | PRIMARY       | PRIMARY | 4       | const |    1 |   100.00 | NULL  |
+----+-------------+-----------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
1 row in set, 1 warning (0.00 sec)
```

```SQL
mysql> explain select * from employees where first_name = "Georgi";
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+
|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299379 |    10.00 | Using where |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+
1 row in set, 1 warning (0.00 sec)
```

执行计划报告解析：

总的来说，主要看 `type`、`possible_keys`、`key`、`rows` 这几个字段

- `possible_keys`：表示有哪些候选的索引
- `key`：表示最终用了哪个索引
- `type`：索引的效果指标，`const` > `ref` > `range` > `index` ~= `ALL`
  - `const`：聚簇索引或者二级索引、`where` 等值匹配、单表查询、查询结果只有单行匹配
  - `ref`：二级索引、`where` 等值匹配、查询结果有多行匹配
  - `range`：二级索引、`where` 范围匹配
  - `index`：扫描聚簇索引的所有叶子结点（效果约等于全表扫描）
  - `ALL`：全表扫描
- `row`：需要扫描的总行数（当然越少越好）
